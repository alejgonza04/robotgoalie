  import cv2
import serial

# Set up serial communication with Arduino
arduino = serial.Serial('/dev/ttyUSB0', 9600, timeout=1)  # Update with the correct port

# Start video capture
cap = cv2.VideoCapture(0)

while True:
    ret, frame = cap.read()
    if not ret:
        continue
    
    # Convert frame to grayscale (or use color filtering to detect ball)
    gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
    blurred = cv2.GaussianBlur(gray, (15, 15), 0)
    
    # Detect ball using HoughCircles (modify parameters as needed)
    circles = cv2.HoughCircles(blurred, cv2.HOUGH_GRADIENT, 1.2, 30,
                               param1=50, param2=30, minRadius=10, maxRadius=50)
    
    if circles is not None:
        circles = sorted(circles[0], key=lambda x: x[0])  # Sort by x-coordinate
        ball_x = circles[0][0]  # Get ball's X position
        frame_width = frame.shape[1]

        # Determine movement command
        if ball_x < frame_width * 0.33:
            arduino.write(b"LEFT\n")
        elif ball_x > frame_width * 0.66:
            arduino.write(b"RIGHT\n")
        else:
            arduino.write(b"CENTER\n")

    # Show frame (for debugging)
    cv2.imshow('Frame', frame)
    if cv2.waitKey(1) & 0xFF == ord('q'):
        break

cap.release()
cv2.destroyAllWindows()
